parameters:
  - name: EirctlVersion
    type: string
  - name: TerraformVersion
    type: string
  - name: EnsonoBuildVersion
    type: string
  - name: DockerPushRMVersion
    type: string
  - name: YqVersion
    type: string
  - name: BuildNumber
    type: string
  - name: DockerContainerRegistryName
    type: string
steps:
    - task: PowerShell@2
      displayName: Configure Agent
      inputs:
        targetType: inline
        script: |
          $InformationPreference = "Continue"

          $splat = @{
            EirctlVersion = "${{ parameters.EirctlVersion }}"
            TerraformVersion = "${{ parameters.TerraformVersion }}"
            EnsonoBuildVersion = "${{ parameters.EnsonoBuildVersion }}"
            DockerPushRMVersion = "${{ parameters.DockerPushRMVersion }}"
            YqVersion = "${{ parameters.YqVersion }}"
            BuildNumber = "${{ parameters.BuildNumber }}"
            DockerContainerRegistryName = "${{ parameters.DockerContainerRegistryName }}"
          }

          $splat

          . build/scripts/Initialize-Agent.ps1 @splat
