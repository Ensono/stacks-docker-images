name: "$(Build.SourceBranchName)-init"

pr:
  - master

trigger:
  branches:
    include:
      - 'main'
  paths:
    include:
      - '*'

variables:
  - template: azuredevops-vars.yml
  - name: DOCKER_PASSWORD
    value: $(DOCKER_PASSWORD)
# Configure the stages
stages:

  - stage: Build

    jobs:

    - job: Build

      steps:

        # Install Taskctl for the build to run
        - task: Bash@3
          displayName: Install Taskctl
          inputs:
            targetType: inline
            script: |
              wget https://github.com/taskctl/taskctl/releases/download/${{ variables.TaskctlVersion }}/taskctl_${{ variables.TaskctlVersion }}_linux_amd64.tar.gz -O /tmp/taskctl.tar.gz
              tar zxf /tmp/taskctl.tar.gz -C /usr/local/bin taskctl 

        # Run the task to generate the PowerShell module files
        - task: Bash@3
          displayName: Build Images
          inputs:
            targetType: inline
            script: |
              taskctl build
          ${{ if eq(variables['Build.SourceBranch'], 'refs/heads/main') }}: # On main branch runs
            env: 
              PUBLISH_RELEASE: $true
        # # Generate the documentation
        # - task: Bash@3
        #   displayName: Generate Documentation
        #   inputs:
        #     targetType: inline
        #     script: |
        #       taskctl docs

        # # Upload the documentation
        # - task: PublishBuildArtifacts@1
        #   displayName: Publish Documentation
        #   inputs:
        #     pathToPublish: $(Build.SourcesDirectory)/outputs/docs
        #     artifactName: docs
