This repository contains all of the Dockerfile definitions required for Amido.

# Stacks Docker Images

This repository contains the Dockerfiles that are required to build containers used in Amido Stacks pipelines.

The main documentation can be found in the `docs/` directory.

The build process for these images, uses two components.

## Bootstrapping

### Docker Images

The images themselves are a dependency for building them. This means that a a set of bootstrap images are required. In order to achieve this, you will need to manually run `docker build` and `docker image push` to push the images to a registry. Alternatively, you can install the `AmidoBuild` module located in the `independent-runner` repo and use the `Build-DockerImage` function. Example commands for this are illustrated below:

Base image:

```powershell
build-Dockerimage -buildargs ./image_definitions/base -push -generic -registry docker.io -name <YOUR ORG>/runner-pwsh -tag 0.1.1-beta
```

Dotnet image:

```powershell
build-Dockerimage -buildargs ./image_definitions/dotnet -push -generic -registry docker.io -name <YOUR ORG>/runner-pwsh-dotnet -tag 0.1.1-beta
```

Once the images are published to a remote registry, amend the `contexts.yml` file linked in the main `taskctl.yaml` to point to these temporary images and run the pipeline. The pipeline will publish the images to your desired remote registry and you can revert or update the `contexts.yml` file as appropriate to point to the images generated by the automated pipeline.

These manual commands  need only be used for the initial bootstrapping, once you have the images built and pushed to a remote registry for consumption by the `taskctl` pipeline, you can use this pipeline to publish the images automatically to your desired registry, and then amend the `contexts.yml` file linked in the main `taskctl.yaml`.

### Powershell Module

Currently the powershell module is hosted in `amido/independent-runner` repo and is ingested during the base container build process. This may be amended to a runtime ingestion.
