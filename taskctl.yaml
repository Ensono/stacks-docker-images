import:
- ./build/taskctl/contexts.yaml
- ./build/taskctl/tasks.yaml

pipelines:

  setup:
  - task: build:number

  build:base:
  - task: build:container
    variables:
      IMAGE_NAME: amidostacks/runner-pwsh
      DOCKERFILE: ./image_definitions/base

  build:dotnet:
  - task: build:container
    variables:
      IMAGE_NAME: amidostacks/runner-pwsh-dotnet
      DOCKERFILE: ./image_definitions/dotnet

  build:java:
  - task: build:container
    variables:
      IMAGE_NAME: amidostacks/runner-pwsh-java
      DOCKERFILE: ./image_definitions/java

  build:pester:
  - task: build:container
    variables:
      IMAGE_NAME: amidostacks/runner-pwsh-pester
      DOCKERFILE: ./image_definitions/pester

  build:java-sign:
    - task: build:container
      variables:
        IMAGE_NAME: amidostacks/runner-java-sign
        DOCKERFILE: ./image_definitions/java-sign

  publish:
  - task: update:dashboard

  all: # Simulating a full run of the CI/CD tool.
  - pipeline: setup
  - pipeline: build:base
    depends_on: [setup]
  - pipeline: build:dotnet
    depends_on: [build:base]
  - pipeline: build:java
    depends_on: [build:base]
  - pipeline: build:pester
    depends_on: [build:base]
  - pipeline: build:java-sign
    depends_on: [build:base]
  - pipeline: publish
    depends_on: [build:base, build:dotnet, build:java, build:pester, build:java-sign]
